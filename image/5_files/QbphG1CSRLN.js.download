;/*FB_PKG_DELIM*/

__d("ChatReliabilityTypedLogger",["Banzai","GeneratedLoggerUtils"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){this.$1={}}var c=a.prototype;c.log=function(a){b("GeneratedLoggerUtils").log("logger:ChatReliabilityLoggerConfig",this.$1,b("Banzai").BASIC,a)};c.logVital=function(a){b("GeneratedLoggerUtils").log("logger:ChatReliabilityLoggerConfig",this.$1,b("Banzai").VITAL,a)};c.logImmediately=function(a){b("GeneratedLoggerUtils").log("logger:ChatReliabilityLoggerConfig",this.$1,{signal:!0},a)};c.clear=function(){this.$1={};return this};c.getData=function(){return babelHelpers["extends"]({},this.$1)};c.updateData=function(a){this.$1=babelHelpers["extends"]({},this.$1,a);return this};c.setEvent=function(a){this.$1.event=a;return this};c.setEventData=function(a){this.$1.event_data=a;return this};return a}();c={event:!0,event_data:!0};f["default"]=a}),66);
__d("MessengerWebGraphQLTypedLogger",["Banzai","GeneratedLoggerUtils"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){this.$1={}}var c=a.prototype;c.log=function(a){b("GeneratedLoggerUtils").log("logger:MessengerWebGraphQLLoggerConfig",this.$1,b("Banzai").BASIC,a)};c.logVital=function(a){b("GeneratedLoggerUtils").log("logger:MessengerWebGraphQLLoggerConfig",this.$1,b("Banzai").VITAL,a)};c.logImmediately=function(a){b("GeneratedLoggerUtils").log("logger:MessengerWebGraphQLLoggerConfig",this.$1,{signal:!0},a)};c.clear=function(){this.$1={};return this};c.getData=function(){return babelHelpers["extends"]({},this.$1)};c.updateData=function(a){this.$1=babelHelpers["extends"]({},this.$1,a);return this};c.setErrorMessage=function(a){this.$1.error_message=a;return this};c.setEvent=function(a){this.$1.event=a;return this};c.setQueryParams=function(a){this.$1.query_params=a;return this};return a}();c={error_message:!0,event:!0,query_params:!0};f["default"]=a}),66);
__d("CallbackManagerController",["ErrorGuard"],(function(a,b,c,d,e,f){var g;a=function(){function a(a){this.$2=[],this.$1=[void 0],this.$3=a}var c=a.prototype;c.executeOrEnqueue=function(a,b,c){c=Boolean(c)?c:{};var d=this.$4(b,a,c);if(d)return 0;this.$1.push({fn:b,request:a,options:c});d=this.$1.length-1;this.$2.push(d);return d};c.unsubscribe=function(a){delete this.$1[a]};c.reset=function(){this.$1=[]};c.getRequest=function(a){return this.$1[a]};c.runPossibleCallbacks=function(a){var b=this,c=this.$2;this.$2=[];var d=[];c.forEach(function(c){var e=b.$1[c];if(!e)return;e=b.$3(e.request,babelHelpers["extends"]({},e.options,a));e?d.push({args:e,id:c}):b.$2.push(c)});d.forEach(function(a){var c=a.args;a=a.id;var d=b.$1[a];if(!d)return;delete b.$1[a];b.$5(d.fn,c,d.request)})};c.$4=function(a,b,c){c=this.$3(b,c);c&&this.$5(a,c,b);return!!c};c.$5=function(a,c,d){d={ids:d};(g||(g=b("ErrorGuard"))).applyWithGuard(a,d,c)};return a}();f["default"]=a}),66);
__d("KeyedCallbackManager",["CallbackManagerController","FBLogger"],(function(a,b,c,d,e,f){a=function(){function a(){this.$2={},this.$1=new(b("CallbackManagerController"))(this.$3.bind(this))}var c=a.prototype;c.executeOrEnqueue=function(a,c){if(!(a instanceof Array)){var d=a,e=c;a=[a];c=function(a){e(a[d])}}a=a.filter(function(a){var c=a!==null&&a!==void 0;c||b("FBLogger")("KeyedCallbackManager").mustfix("KeyedCallbackManager.executeOrEnqueue: key %s is invalid",JSON.stringify(a));return c});return this.$1.executeOrEnqueue(a,c)};c.unsubscribe=function(a){this.$1.unsubscribe(a)};c.reset=function(){this.$1.reset(),this.$2={}};c.getUnavailableResources=function(a){var b=this;a=this.$1.getRequest(a);var c=[];a&&(c=a.request.filter(function(a){return!b.$2[a]}));return c};c.getUnavailableResourcesFromRequest=function(a){var b=this;a=Array.isArray(a)?a:[a];return a.filter(function(a){if(a!==null&&a!==void 0)return!b.$2[a]})};c.addResourcesAndExecute=function(a){Object.assign(this.$2,a),this.$1.runPossibleCallbacks()};c.setResource=function(a,b){this.$2[a]=b,this.$1.runPossibleCallbacks()};c.getResource=function(a){return this.$2[a]};c.getAllResources=function(){return this.$2};c.dumpResources=function(){var a=this,b={};Object.keys(this.$2).forEach(function(c){var d=a.$2[c];typeof d==="object"&&(d=babelHelpers["extends"]({},d));b[c]=d});return b};c.$3=function(a){var b={};for(var c=0;c<a.length;c++){var d=a[c],e=this.$2[d];if(typeof e==="undefined")return!1;b[d]=e}return[b]};return a}();f["default"]=a}),66);
__d("BaseAsyncLoader",["KeyedCallbackManager","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f){var g={};function h(a,c,d){var e=new(b("KeyedCallbackManager"))(),f=!1,g=[];function h(){if(!g.length||f)return;f=!0;b("setTimeoutAcrossTransitions")(j,0)}function i(a){f=!1,a.forEach(e.unsubscribe.bind(e)),h()}function j(){var b={},c=[];g=g.filter(function(a){var d=e.getUnavailableResources(a);if(d.length){d.forEach(function(a){b[a]=!0});c.push(a);return!0}return!1});var h=Object.keys(b);h.length?d(a,h,c,k.bind(null,c),l.bind(null,c)):f=!1}function k(a,b){b=b.payload[c]||b.payload;e.addResourcesAndExecute(b);i(a)}function l(a){i(a)}return{get:function(a,b){a=e.executeOrEnqueue(a,b);b=e.getUnavailableResources(a);b.length&&(g.push(a),h())},getCachedKeys:function(){return Object.keys(e.getAllResources())},getNow:function(a){return e.getResource(a)||null},set:function(a){e.addResourcesAndExecute(a)}}}function a(a,b){throw new Error("BaseAsyncLoader can't be instantiated")}Object.assign(a.prototype,{_getLoader:function(){g[this._endpoint]||(g[this._endpoint]=h(this._endpoint,this._type,this.send));return g[this._endpoint]},get:function(a,b){return this._getLoader().get(a,b)},getCachedKeys:function(){return this._getLoader().getCachedKeys()},getNow:function(a){return this._getLoader().getNow(a)},reset:function(){g[this._endpoint]=null},set:function(a){this._getLoader().set(a)}});e.exports=a}),null);
__d("AjaxLoader",["AsyncRequest","BaseAsyncLoader","LogHistory"],(function(a,b,c,d,e,f){var g=b("LogHistory").getInstance("ajax_loader");function a(a,b){this._endpoint=a,this._type=b}Object.assign(a.prototype,b("BaseAsyncLoader").prototype);a.prototype.send=function(a,c,d,e,f){new(b("AsyncRequest"))().setURI(a).setData({ids:c}).setMethod("POST").setReadOnly(!0).setAllowCrossPageTransition(!0).setHandler(function(a){e(a)}).setTimeoutHandler(10*1e3,function(a){f(),g.error("fetch_timeout","{}")}).setErrorHandler(function(a){f(),g.error("fetch_error",JSON.stringify({error_type:a.errorSummary,error_text:a.errorDescription}))}).send()};e.exports=a}),null);
__d("XChatUserInfoAllAsyncController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/chat/user_info_all/",{viewer:{type:"Int",required:!0}})}),null);
__d("ShortProfilesBootstrapper",["AsyncRequest","CurrentUser","ODS","Promise","XChatUserInfoAllAsyncController"],(function(a,b,c,d,e,f){"use strict";var g,h,i=5,j=1e4,k=b("XChatUserInfoAllAsyncController").getURIBuilder().setInt("viewer",b("CurrentUser").getID()).getURI();a=function(){function a(a){var c=this;this.$1=a;this.$2=new(g||(g=b("Promise")))(function(a,b){c.$3=a,c.$4=b});this.$5=!1;this.$6=null;this.$7=0;this.$8=0;this.$9=0;this.$10=!1;this.$11=!1}var c=a.prototype;c.fetchAll=function(){var a=this;this.$12();if(this.$5||this.$6)return this.$2;if(this.$7>=i){this.$13();return this.$2}this.$7++;this.$14();this.$6=new(b("AsyncRequest"))(k).setHandler(function(b){a.$6=null,a.$5=!0,a.$15(),a.$1(b.payload),a.$3()}).setErrorHandler(function(){a.$6=null,a.$8++,a.$16()}).setTimeoutHandler(j,function(){a.$6=null,a.$9++,a.$17(),a.fetchAll()}).setAllowCrossPageTransition(!0);this.$6.send();return this.$2};c.isBootstrapped=function(){return this.$5};c.isBootstrapping=function(){return!!this.$6};c.getAttemptCount=function(){return this.$7};c.getErrorCount=function(){return this.$8};c.getTimeoutCount=function(){return this.$9};c.$12=function(){this.$10||((h||(h=b("ODS"))).bumpEntityKey(3303,"chat.web","typeahead.bootstrap.starts"),this.$10=!0)};c.$14=function(){(h||(h=b("ODS"))).bumpEntityKey(3303,"chat.web","typeahead.bootstrap.attempts")};c.$15=function(){(h||(h=b("ODS"))).bumpEntityKey(3303,"chat.web","typeahead.bootstrap.successes"),this.$7>1&&(h||(h=b("ODS"))).bumpEntityKey(3303,"chat.web","typeahead.bootstrap.successes_after_retries")};c.$16=function(){(h||(h=b("ODS"))).bumpEntityKey(3303,"chat.web","typeahead.bootstrap.errors")};c.$17=function(){(h||(h=b("ODS"))).bumpEntityKey(3303,"chat.web","typeahead.bootstrap.timeouts")};c.$13=function(){this.$11||((h||(h=b("ODS"))).bumpEntityKey(3303,"chat.web","typeahead.bootstrap.giveups"),this.$11=!0,this.$4())};return a}();e.exports=a}),null);
__d("XChatUserInfoAsyncController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/chat/user_info/",{ids:{type:"IntVector",defaultValue:[]}})}),null);
__d("ShortProfiles",["AjaxLoader","CurrentUser","ShortProfilesBootstrapper","URI","XChatUserInfoAsyncController","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h=null,i=new(c("AjaxLoader"))(c("XChatUserInfoAsyncController").getURIBuilder().getURI().toString(),"profiles");function a(a,b){j([a],function(c){return b(c[a],a)})}function j(a,b){i.get(a,b||c("emptyFunction"))}function k(a){return i.getNow(a)||null}function b(a){var b={};a.forEach(function(a){return b[a]=k(a)});return b}function d(){return i.getCachedKeys()}function e(){return!!h&&h.isBootstrapped()}function f(){h||(h=new(c("ShortProfilesBootstrapper"))(function(a){i.set(a)}));return h.fetchAll()}function l(a,b){var c={};c[a]=b;m(c)}function m(a){if(c("CurrentUser").isWorkUser()){var b={};Object.keys(a).forEach(function(d){var e=a[d];(e.type!=="fb4c"||!e.uri)&&(b[d]=e);var f=new(c("URI"))(e.uri).setDomain("").setProtocol("").toString();b[d]=babelHelpers["extends"]({},e,{uri:f})});a=b}i.set(a)}g.get=a;g.getMulti=j;g.getNow=k;g.getMultiNow=b;g.getCachedProfileIDs=d;g.hasAll=e;g.fetchAll=f;g.set=l;g.setMulti=m}),98);
__d("ChatReliabilityEvents",[],(function(a,b,c,d,e,f){a=Object.freeze({ERROR:"error",CHANNEL_DISCONNECT:"channel_disconnect",CHANNEL_CONNECT:"channel_connect",CHANNEL_INIT:"channel_init",CHANNEL_NOCONFIG:"channel_noconfig",CHANNEL_HISTORY_INVALID:"channel_history_invalid",CHANNEL_STALLED:"channel_stalled",MESSAGE_RECEIVED:"msg_received",MESSAGE_SEND_START:"msg_send_start",THREAD_INFO_ENDPOINT_FATAL:"thread_info_fatal",DFF_ENDPOINT_FATAL:"invalidate_global_state_fatal",DFF_DELTA_INIT:"dff_initiated_by_delta",DFF_HOLE_INIT:"dff_initiated_by_hole",FETCHING_MANY_MESSAGES:"fetching_many_messages",THREAD_INFO_MISSING:"thread_info_missing",SET_THREAD_ID_MAP:"set_thread_id_map",DELETE_THREAD:"delete_thread",PROCESS_DELTA:"process_delta",RTI_SESSION:"chatproxy_rti_session",ON_INVALID_HISTORY:"chatproxy_on_invalid_history",GET_DEBUG_PRESENCE:"chatproxy_get_debug_presence"});f["default"]=a}),66);
__d("ChatReliabilityInstrumentation",["ChatReliabilityEvents","ChatReliabilityTypedLogger","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a,b){if(!c("gkx")("678576"))return;new(c("ChatReliabilityTypedLogger"))().setEvent(a).setEventData(b).log()};function a(a){h(c("ChatReliabilityEvents").ERROR,a)}function b(a){h(c("ChatReliabilityEvents").CHANNEL_DISCONNECT,a)}function d(a){h(c("ChatReliabilityEvents").CHANNEL_CONNECT,a)}function e(a){h(c("ChatReliabilityEvents").CHANNEL_HISTORY_INVALID,a)}function f(a){h(c("ChatReliabilityEvents").MESSAGE_RECEIVED,a)}function i(a){h(c("ChatReliabilityEvents").MESSAGE_SEND_START,a)}function j(a){h(c("ChatReliabilityEvents").CHANNEL_STALLED,a)}function k(a){h(c("ChatReliabilityEvents").CHANNEL_INIT,a)}function l(a){h(c("ChatReliabilityEvents").CHANNEL_NOCONFIG,a)}function m(a){h(c("ChatReliabilityEvents").DFF_DELTA_INIT,a)}function n(a){h(c("ChatReliabilityEvents").DFF_HOLE_INIT,a)}function o(a){h(c("ChatReliabilityEvents").FETCHING_MANY_MESSAGES,a)}function p(a){h(c("ChatReliabilityEvents").PROCESS_DELTA,a)}function q(a){h(c("ChatReliabilityEvents").THREAD_INFO_MISSING,a)}function r(a){h(c("ChatReliabilityEvents").SET_THREAD_ID_MAP,a)}function s(a){h(c("ChatReliabilityEvents").DELETE_THREAD,a)}function t(a){h(a)}g.logERROR=a;g.logCHANNEL_DISCONNECT=b;g.logCHANNEL_CONNECT=d;g.logCHANNEL_HISTORY_INVALID=e;g.logMESSAGE_RECEIVED=f;g.logMESSAGE_SEND_START=i;g.logCHANNEL_STALLED=j;g.logCHANNEL_INIT=k;g.logCHANNEL_NOCONFIG=l;g.logDFF_DELTA_INIT=m;g.logDFF_HOLE_INIT=n;g.logFETCHING_MANY_MESSAGES=o;g.logPROCESS_DELTA=p;g.logTHREAD_INFO_MISSING=q;g.logSET_THREAD_ID_MAP=r;g.logDELETE_THREAD=s;g.logCHATPROXY_EVENT=t}),98);
__d("MercuryMessagingLightswitch",[],(function(a,b,c,d,e,f){"use strict";a={guard:function(a){return},shouldRun:function(){return!1}};b=a;f["default"]=b}),66);
__d("MercuryServerURIs",[],(function(a,b,c,d,e,f){"use strict";a="/ajax/mercury/thread_info.php";b="/ajax/mercury/mark_folder_as_read.php";c="/ajax/mercury/change_read_status.php";d="/ajax/mercury/mark_seen.php";e="/ajax/mercury/threadlist_info.php";var g="/ajax/mercury/mark_spam.php",h="/ajax/mercury/unmark_spam.php",i="/ajax/mercury/unread_threads.php",j="/ajax/mercury/change_pinned_status.php",k="/ajax/mercury/change_archived_status.php",l="/ajax/mercury/change_page_follow_up_status.php",m="/ajax/mercury/delete_thread.php",n="/ajax/mercury/delete_messages.php",o="/ajax/mercury/delivery_receipts.php",p="/ajax/mercury/move_thread.php",q="/ajax/mercury/change_mute_thread.php";f.THREAD_INFO=a;f.MARK_FOLDER_READ=b;f.CHANGE_READ_STATUS=c;f.MARK_SEEN=d;f.THREADLIST_INFO=e;f.MARK_SPAM=g;f.UNMARK_SPAM=h;f.UNREAD_THREADS=i;f.CHANGE_PINNED_STATUS=j;f.CHANGE_ARCHIVED_STATUS=k;f.CHANGE_PAGE_FOLLOW_UP_STATUS=l;f.DELETE_THREAD=m;f.DELETE_MESSAGES=n;f.DELIVERY_RECEIPTS=o;f.MOVE_THREAD=p;f.CHANGE_MUTE_THREAD=q}),66);
__d("MercuryServerDispatcher",["AsyncRequest","AsyncResponse","BanzaiLogger","Bootloader","ChatReliabilityInstrumentation","CurrentUser","FBIDCheck","LogHistory","MercuryMessagingLightswitch","MercuryServerURIs","MessagingTag","MessengerWebGraphQLTypedLogger","areJSONRepresentationsEqual","debounceAcrossTransitions","getByPath","performanceAbsoluteNow","promiseDone"],(function(a,b,c,d,e,f){"use strict";var g,h={},i=b("LogHistory").getInstance("mercury_server_dispatcher"),j=50,k=[],l=!1,m={IMMEDIATE:"immediate",IDEMPOTENT:"idempotent",BATCH_SUCCESSIVE:"batch-successive",BATCH_SUCCESSIVE_UNIQUE:"batch-successive-unique",BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR:"batch-successive-piggyback-retry",BATCH_DEFERRED_MULTI:"batch-deferred-multi",BATCH_CONDITIONAL:"batch-conditional",DEFAULT_ENDPOINT_ID:"mercuryServerDispatcherDefaultEndpointID",registerEndpoints:function(a){for(var c in a){var d=a[c],e=d.request_user_id||b("CurrentUser").getID(),f=d.endpoint_id||m.DEFAULT_ENDPOINT_ID;h[c]||(h[c]={});h[c][e]||(h[c][e]={});h[c][e][f]=new n(c,d)}},trySend:function(a,c,d,e,f){e=e||b("CurrentUser").getID(),f=f||m.DEFAULT_ENDPOINT_ID,h[a][e][f].trySend(c,d)},getRequestErrors:function(){return k}};function n(a,c){var d=c.mode||m.IMMEDIATE;switch(d){case m.IMMEDIATE:case m.IDEMPOTENT:case m.BATCH_SUCCESSIVE:case m.BATCH_SUCCESSIVE_UNIQUE:case m.BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR:case m.BATCH_DEFERRED_MULTI:case m.BATCH_CONDITIONAL:break;default:throw new Error("Invalid MercuryServerDispatcher mode "+d)}this._endpoint=a;this._mode=d;this._customHeader=c.customHeader;this._requestUserID=c.request_user_id;this._combineData=c.batch_function;this._combineDataIf=c.batch_if;this._batches=[];this._handler=c.handler;this._errorHandler=c.error_handler;this._transportErrorHandler=c.transport_error_handler||c.error_handler;this._connectionRetries=c.connection_retries||0;this._timeoutHandler=c.timeout_handler;this._timeout=c.timeout;this._serverDialogCancelHandler=c.server_dialog_cancel_handler||c.error_handler;this._deferredSend=b("debounceAcrossTransitions")(this._batchSend,0,this)}Object.assign(n.prototype,{_inFlight:0,_handler:null,_errorHandler:null,_transportErrorHandler:null,_timeoutHandler:null,_timeout:null,_serverDialogCancelHandler:null,_combineData:null,trySend:function(a,b){if(l)return;a===void 0&&(a=null);b=b||this._mode;if(b==m.IMMEDIATE)this._send(a);else if(b==m.IDEMPOTENT)this._inFlight||this._send(a);else if(b==m.BATCH_SUCCESSIVE||b==m.BATCH_SUCCESSIVE_UNIQUE)!this._inFlight?this._send(a):this._batchData(a);else if(b==m.BATCH_CONDITIONAL){var c=this._batches[0]&&this._batches[0].getData();this._inFlight&&(this._combineDataIf(this._pendingRequestData,a)||this._combineDataIf(c,a))?this._batchData(a):this._send(a)}else b==m.BATCH_DEFERRED_MULTI?(this._batchData(a),this._deferredSend()):b==m.BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR&&(this._batchData(a),this._inFlight||this._batchSend())},_send:function(a){var c=this;this._inFlight++;this._pendingRequestData=babelHelpers["extends"]({},a);this._requestUserID!=b("CurrentUser").getID()&&(a.request_user_id=this._requestUserID);b("MercuryMessagingLightswitch").guard(function(){i.log("send",JSON.stringify({endpoint:c._endpoint,inflight_count:c._inFlight}))});var d=(g||(g=b("performanceAbsoluteNow")))(),e=new(b("AsyncRequest"))(this._endpoint).setData(a).setOption("retries",this._connectionRetries).setAllowCrossPageTransition(!0);this._customHeader&&e.setRequestHeader(this._customHeader.name,this._customHeader.value);if(this._endpoint===b("MercuryServerURIs").THREADLIST_INFO){b("Bootloader").loadModules(["MessengerGraphQLThreadlistFetcher.bs","MercuryJewelBootloadModules"],function(f,g){var h=a.request_user_id||b("CurrentUser").getID(),d=a.request_user_id&&!b("FBIDCheck").isUser_deprecated(a.request_user_id);g=(g={},g[b("MessagingTag").INBOX]="INBOX",g[b("MessagingTag").OTHER]="OTHER",g[b("MessagingTag").ACTION_ARCHIVED]="ARCHIVED",g[b("MessagingTag").SPAM]="SPAM",g[b("MessagingTag").PENDING]="PENDING",g[b("MessagingTag").PAGE_BACKGROUND]="PAGE_BACKGROUND",g);var i=[],j=Object.keys(g);for(var k=0;k<j.length;k++){var l=j[k];if(Object.prototype.hasOwnProperty.call(a,l)){var m=a[l];i.push({limit:m.before?m.limit+1:m.limit,folder:l,tags:m.filter?[g[l],m.filter]:[g[l]],timestamp:m.before,filter:m.filter,includeDeliveryReceipts:!0,includeSeqID:!1,source:a.client})}}l=function(){b("promiseDone")(f.fetchAll(h,i,d,"fetch_threadlist"),function(a){a=new(b("AsyncResponse"))(e,babelHelpers["extends"]({},a,{payload_source:"server_fetch_threadlist_info"}));c._handleResponse(a)},function(a){c._handleGraphQLError("threadlist_failure",i,a,e)})};l()},"MercuryServerDispatcher");return}if(this._endpoint===b("MercuryServerURIs").THREAD_INFO){var f,h=(f=b("getByPath"))(a,["threads","user_ids"],[]),j=f(a,["threads","thread_fbids"],[]),k=f(a,["messages","user_ids"],{}),l=f(a,["messages","thread_fbids"],{}),m=a.request_user_id&&!b("FBIDCheck").isUser_deprecated(a.request_user_id);b("Bootloader").loadModules(["MessengerGraphQLThreadFetcher.bs"],function(d){var f=a.request_user_id||b("CurrentUser").getID(),g=Object.keys(k),i=g.map(function(b){var c=k[b].limit,d=k[b].timestamp;return{id:b,limit:d?c+1:c,loadReadReceipts:!0,loadDeliveryReceipts:!0,timestamp:d,isCanonical:!0,source:a.client}}),n=new Set(g);h.forEach(function(b){if(n.has(b))return;i.push({id:b,limit:0,loadReadReceipts:!1,loadDeliveryReceipts:!1,timestamp:null,isCanonical:!0,source:a.client})});g=Object.keys(l);var o=g.map(function(b){var c=l[b].limit,d=l[b].timestamp;return{id:b,limit:d?c+1:c,loadReadReceipts:!0,loadDeliveryReceipts:!0,timestamp:d,isCanonical:!1,source:a.client}}),p=new Set(g);j.forEach(function(b){if(p.has(b))return;o.push({id:b,limit:0,loadReadReceipts:!1,loadDeliveryReceipts:!1,timestamp:null,isCanonical:!1,source:a.client})});var q=[].concat(i,o);q.forEach(function(a){a.limit>21&&b("ChatReliabilityInstrumentation").logFETCHING_MANY_MESSAGES(JSON.stringify(a))});b("promiseDone")(d.fetchAll(f,q,m),function(a){a=a.slice(0);if(a.length>0){var d={};a.forEach(function(a){return Object.assign(d,a.roger)});var f=[];a.forEach(function(a){return f.push.apply(f,a.delivery_receipts)});var g=[];a.forEach(function(a){return g=g.concat(a.actions)});g=g.filter(Boolean);a={actions:g,threads:a.map(function(a){return a.thread}).filter(Boolean),end_of_history:a.map(function(a){return a.end_of_history}).filter(Boolean),roger:d,delivery_receipts:f,payload_source:"server_fetch_thread_info"};a=new(b("AsyncResponse"))(e,a);c._handleResponse(a)}else c._handleResponse(new(b("AsyncResponse"))(e,{}))},function(a){c._handleGraphQLError("thread_failure",q,a,e)})},"MercuryServerDispatcher");return}e.setHandler(function(a){b("MercuryMessagingLightswitch").guard(function(){b("BanzaiLogger").log("ChatPerfLoggerConfig",{event:"async_request",duration:(g||(g=b("performanceAbsoluteNow")))()-d,endpoint:c._endpoint})}),c._handleResponse(a)}).setErrorHandler(this._handleError.bind(this)).setTransportErrorHandler(this._handleTransportError.bind(this)).setServerDialogCancelHandler(this._handleServerDialogCancel.bind(this));this._timeout&&this._timeoutHandler&&e.setTimeoutHandler(this._timeout,this._handleTimeout.bind(this));e.send()},_handleGraphQLError:function(a,c,d,e){var f=null,g=e.getData().retry_count;typeof d.toString==="function"&&(f=d.toString());if(typeof d.getRequest!=="function"){var h=d.errors&&d.errors[0];d=new(b("AsyncResponse"))(e,d);d.errorSummary=d.errors&&d.errors.map();d.errorDescription=h?h.message:null;f=h&&h.message?h.message:f;d.silentError=h&&h.is_silent;d.transientError=h&&h.is_transient}g||new(b("MessengerWebGraphQLTypedLogger"))().setErrorMessage(f).setEvent(a).setQueryParams(JSON.stringify(c)).log();this._handleError(d)},_batchData:function(a,c){var d=this;if(this._mode==m.BATCH_SUCCESSIVE_UNIQUE&&this._pendingRequestData!==void 0&&b("areJSONRepresentationsEqual")(a,this._pendingRequestData))return;else{var e=this._batches.length-1;e>=0?c?this._batches[e].combineWithOlder(a,this._combineData):this._batches[e].combineWith(a,this._combineData):this._batches.push(new o(a));b("MercuryMessagingLightswitch").guard(function(){i.debug("batch",JSON.stringify({endpoint:d._endpoint}))})}},_batchSend:function(){this._batches[0]&&(this._send(this._batches[0].getData()),this._batches.shift())},_handleResponse:function(a){var c=this;this._inFlight--;b("MercuryMessagingLightswitch").guard(function(){i.log("response",JSON.stringify({endpoint:c._endpoint,inflight_count:c._inFlight}))});var d=a.getPayload();l=d&&d.kill_chat;l&&b("MercuryMessagingLightswitch").guard(function(){i.log("killswitch_enabled",JSON.stringify({endpoint:c._endpoint,inflight_count:c._inFlight}))});d&&d.error_payload?this._errorHandler&&this._errorHandler(a):this._handler&&this._handler(d,a.getRequest());(this._mode==m.BATCH_SUCCESSIVE||this._mode==m.BATCH_SUCCESSIVE_UNIQUE||this._mode==m.BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR||this._mode==m.BATCH_CONDITIONAL)&&this._batchSend();delete this._pendingRequestData},_createErrorRecord:function(a){return a instanceof b("AsyncResponse")?{endpoint:this._endpoint,user:this._requestUserID,time:Date.now(),code:a.getError(),description:a.getErrorDescriptionString(),summary:a.getErrorSummary(),isSilent:a.isSilent,isTransient:a.isTransient(),isBlockedAction:a.isBlockedAction(),isWarning:a.getErrorIsWarning(),payload:a.getPayload()}:{endpoint:this._endpoint,user:this._requestUserID,time:Date.now(),description:a.toString()}},_postErrorHandler:function(a){var c=this;this._inFlight--;b("MercuryMessagingLightswitch").guard(function(){i.error("error",JSON.stringify({endpoint:c._endpoint,inflight_count:c._inFlight,error:a instanceof b("AsyncResponse")?a.getError()+" "+a.getErrorDescription():a instanceof Error?a.toString():"Unknown"}))});k.push(this._createErrorRecord(a));k.length>j&&(k=k.slice(-1*j));var d=this._mode;d==m.BATCH_SUCCESSIVE||d==m.BATCH_SUCCESSIVE_UNIQUE||d==m.BATCH_CONDITIONAL?this._batchSend():d==m.BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR&&(this._batches[0]?(this._batchData(this._pendingRequestData,!0),this._batchSend()):this._batchData(this._pendingRequestData,!0));delete this._pendingRequestData},_handleError:function(a){this._errorHandler&&this._errorHandler(a),this._postErrorHandler(a)},_handleTransportError:function(a){this._transportErrorHandler&&this._transportErrorHandler(a),this._postErrorHandler(a)},_handleTimeout:function(a){this._timeoutHandler&&this._timeoutHandler(a),this._postErrorHandler(new Error("Endpoint Timeout"))},_handleServerDialogCancel:function(a){this._serverDialogCancelHandler&&this._serverDialogCancelHandler(a),this._postErrorHandler(a)}});function o(a){this._data=a,this._size=1}Object.assign(o.prototype,{getData:function(){return this._data},getSize:function(){return this._size},combineWith:function(a,b){this._data=b(this._data,a),this._size++},combineWithOlder:function(a,b){this._data=b(a,this._data),this._size++}});e.exports=m}),null);
__d("RangedCallbackManager",["CallbackManagerController","arrayStableSort","createObjectFrom"],(function(a,b,c,d,e,f){a=function(){"use strict";function a(a,c,d){this.$1=[],this.$2=!1,this.$3=!1,this.$4={},this.$5=new(b("CallbackManagerController"))(this.$6.bind(this)),this.$7=a,this.$8=c,this.$9=d}var c=a.prototype;c.executeOrEnqueue=function(a,b,c,d,e){return this.$5.executeOrEnqueue({start:a,limit:b},c,{strict:!!d,skipOnStrictHandler:e})};c.unsubscribe=function(a){this.$5.unsubscribe(a)};c.getUnavailableResources=function(a){a=this.$5.getRequest(a);var b=[];if(a&&!this.$2){var c=a.request;a=this.$10(a.options);c=c.start+c.limit;for(a=a.length;a<c;a++)b.push(a)}return b};c.addResources=function(a){var b=this;a.forEach(function(a){b.$4[a]||(b.$4[a]=!0,b.$1.push(a),b.$3=null)});this.resortResources();this.$5.runPossibleCallbacks()};c.addResourcesWithoutSorting=function(a,c){var d=this.$1.slice(0,c);d=d.concat(a);d=d.concat(this.$1.slice(c));this.$1=d;Object.assign(this.$4,b("createObjectFrom")(a,!0));this.$3=null;this.$5.runPossibleCallbacks()};c.removeResources=function(a){var b=this;a.forEach(function(a){if(b.$4[a]){b.$4[a]=!1;a=b.$1.indexOf(a);a!=-1&&b.$1.splice(a,1)}})};c.removeAllResources=function(){this.$1=[],this.$4={}};c.resortResources=function(){var a=this;this.$1=b("arrayStableSort")(this.$1,function(b,c){return a.$8(a.$7(b),a.$7(c))})};c.setReachedEndOfArray=function(){this.$2||(this.$2=!0,this.$3=null,this.$5.runPossibleCallbacks())};c.hasReachedEndOfArray=function(){return this.$2};c.forceRunCallbacks=function(){this.$5.runPossibleCallbacks({force:!0})};c.setError=function(a){this.$3!==a&&(this.$3=a,this.$5.runPossibleCallbacks())};c.getError=function(a,b,c){c=this.$10({strict:c});return a+b>c.length?this.$3:null};c.hasResource=function(a){return this.$4[a]};c.getResourceAtIndex=function(a){return this.$1[a]};c.getAllResources=function(){return this.$1.concat()};c.getCurrentArraySize=function(a){return this.$10(a).length};c.$10=function(a){var b=this.$1;if(a&&a.strict){a=a.skipOnStrictHandler||this.$9;a&&(b=b.filter(a))}return b};c.$6=function(a,b){var c=this.$10(b),d=a.start;a=a.start+a.limit;b=!!(b&&b.force);if(!b&&!this.$2&&!this.$3&&a>c.length)return!1;else{b=c.slice(d,a);d=a>c.length?this.$3:null;return[b,d]}};c.getElementsUntil=function(a){var b=[];for(var c=0;c<this.$1.length;c++){var d=this.$7(this.$1[c]);if(this.$8(d,a)>0)break;b.push(this.$1[c])}return b};return a}();e.exports=a}),null);
__d("FunnelAction",[],(function(a,b,c,d,e,f){"use strict";var g="name",h="payload",i="relative_time",j="tag";a=function(){function a(a,b,c,d){this.$1={},this.$1[g]=a,this.$1[i]=b,c!==void 0&&(this.$1[j]=c),d!==void 0&&(this.$1[h]=JSON.stringify(d))}var b=a.prototype;b.getData=function(){return this.$1};return a}();f["default"]=a}),66);
__d("FunnelRegistry",[],(function(a,b,c,d,e,f){a=Object.freeze({WWW_EXAMPLE_FUNNEL:!0,MSITE_EXAMPLE_FUNNEL:!0,WWW_FEED_SHARE_DIALOG_FUNNEL:!0,MSITE_FEED_SHARE_DIALOG_FUNNEL:!0,WWW_CHAT_QUICKCAM_FUNNEL:!0,PLATFORM_SHARE_DIALOG_FUNNEL:!0,WWW_CANVAS_EDITOR_FUNNEL:!0,MSITE_COMMENT_TYPING_FUNNEL:!0,MSITE_NOTE_READING_FUNNEL:!0,WWW_LISTS_COMPOSER_FUNNEL:!0,WWW_REACTIONS_LIKE_BUTTON_HOVER_FUNNEL:!0,WWW_REACTIONS_NUX_FUNNEL:!0,WWW_COMMENT_REACTIONS_NUX_FUNNEL:!0,MSITE_INLINE_REPLY_COMPOSER_FUNNEL:!0,WWW_LEAD_GEN_DESKTOP_AD_UNIT_FUNNEL:!0,WWW_LEAD_GEN_MSITE_AD_UNIT_FUNNEL:!0,WWW_LINK_PICKER_DIALOG_FUNNEL:!0,WWW_MEME_PICKER_DIALOG_FUNNEL:!0,WWW_SHOP_BUY_FUNNEL:!0,WWW_SNOWLIFT_ACTIONS_FUNNEL:!0,WWW_CANVAS_AD_CREATION_FUNNEL:!0,WWW_SEARCH_AWARENESS_LEARNING_NUX_FUNNEL:!0,WWW_CONSTITUENT_TITLE_UPSELL_FUNNEL:!0,WWW_PAGE_CREATION_FUNNEL:!0,WWW_RECRUITING_PRODUCTS_FUNNEL:!0,WWW_RECRUITING_SEARCH_FUNNEL:!0,WWW_RECRUITING_BULK_EMAIL_FUNNEL:!0,WWW_RECRUITING_LEAVE_HANDLER_FUNNEL:!0,WWW_PMT_FUNNEL:!0,WWW_PULSE_FUNNEL:!0,WWW_ORGTOOL_FUNNEL:!0,WWW_VIDEOS_CASTING_FUNNEL:!0,MSITE_PPD_FUNNEL:!0,WWW_CMS_SEARCH_FUNNEL:!0,SOCIAL_SEARCH_CONVERSION_WWW_FUNNEL:!0,SOCIAL_SEARCH_DASHBOARD_WWW_FUNNEL:!0,GAMES_QUICKSILVER_FUNNEL:!0,SRT_USER_FLOW_FUNNEL:!0,WWW_MEME_PIVOT_FUNNEL:!0,WWW_NOTIFICATION_FUNNEL:!0,MSITE_FEED_ALBUM_CTA_FUNNEL:!0,MTOUCH_COMMENT_STORIES_FUNNEL:!0,WWW_MESSENGER_SHARE_TO_FB_FUNNEL:!0,MISINFORMATION_RESHARE_ALERT_FUNNEL:!0,FACECAST_BROADCASTER_FUNNEL:!0,FACECAST_SCHEDULED_LIVE_FUNNEL:!0,SCHEDULED_WATCH_PARTY_VIEWER_FUNNEL:!0,COLLEGE_COMMUNITY_NUX_ONBOARDING_FUNNEL:!0,WWW_MESSENGER_SEARCH_SESSION_FUNNEL:!0,WWW_MESSENGER_CONTENT_SEARCH_FUNNEL:!0,WWW_LIVE_PRODUCER_FUNNEL:!0,WWW_AD_BREAKS_ONBOARDING_FUNNEL:!0,WWW_LAUNCHPAD_ONBOARDING_FUNNEL:!0,WWW_LEAD_GEN_FORM_EDITOR_FUNNEL:!0,WWW_AD_BREAK_HOME_ONBOARDING_FUNNEL:!0,WEB_MESSENGER_RTC_FUNNEL:!0,WEB_RTC_SCREEN_SHARING_FUNNEL:!0,MTOUCH_NUX_PROFILE_PIC_FUNNEL:!0,ADS_VIDEO_CAPTION_FUNNEL:!0,WWW_BUSINESS_ALERT_FUNNEL:!0,SOCIAL_VR_INTERACTIVE_THREE_SIXTY_FUNNEL:!0,WWW_DIVEBAR_RECENTS_FUNNEL:!0,UNIDASH_EDIT_WIDGET_FUNNEL:!0,MESSENGER_UNIVERSAL_SEARCH_FUNNEL:!0,WWW_BUSINESS_CREATION_FUNNEL:!0,WWW_BUSINESS_VERIFICATION_FUNNEL:!0,WWW_APP_REVIEW_BUSINESS_VERIFICATION_FUNNEL:!0,AEC_APPLICATION_FUNNEL:!0,WWW_MESSENGER_POLL_GROUP_CREATE_FUNNEL:!0,ADS_USER_REPORTING_FUNNEL:!0,MAP_WEB_FUNNEL:!0,INTERN_OOPS_FUNNEL:!0,FRX_FUNNEL:!0,WWW_ACCESSIBILITY_NOTIFICATIONS_JEWEL_TABBING_FUNNEL:!0,MTOUCH_FEED_MISSED_STORIES_FUNNEL:!0,WWW_STORYSET_FUNNEL:!0,POLYGLOT_MAIN_FUNNEL:!0,CREATIVE_STUDIO_CREATION_FUNNEL:!0,CREATIVE_STUDIO_HUB_FUNNEL:!0,CREATIVE_STUDIO_INVITE_JOIN_FUNNEL:!0,FX_PLATFORM_INVITE_JOIN_FUNNEL:!0,FX_PLATFORM_INVITE_SEND_FUNNEL:!0,WWW_LIVE_VIEWER_TIPJAR_FUNNEL:!0,WWW_FUNDRAISER_CREATION_FUNNEL:!0,WWW_FUNDRAISER_EDIT_FUNNEL:!0,WWW_FBL_FUNNEL:!0,WWW_CLUE_FUNNEL:!0,WWW_OFFERS_SIMPLE_COMPOSE_FUNNEL:!0,WWW_OFFERS_SIMPLE_COMPOSE_POST_LIKE_FUNNEL:!0,WWW_SEE_OFFERS_CTA_NUX_FUNNEL:!0,WWW_CHEVRON_FUNNEL:!0,MSITE_AD_BREAKS_ONBOARDING_FLOW_FUNNEL:!0,CASUAL_GROUP_PICKER_FUNNEL:!0,TOPICS_TO_FOLLOW_FUNNEL:!0,WWW_SPATIAL_REACTION_PRODUCTION_FUNNEL:!0,WWW_ADS_TARGETING_AUDIENCE_MANAGER_FUNNEL:!0,WWW_NEWSFEED_TAILLOAD_FUNNEL:!0,SEARCH_ADS_WWW_FUNNEL:!0,KEYFRAMES_FUNNEL:!0,WWW_NOTIFS_UP_NEXT_FUNNEL:!0,MSITE_PROFILE_PICTURE_EDIT_FUNNEL:!0,WWW_PROFILE_INTRO_CARD_EDIT_MEDIA_FUNNEL:!0,BUSINESS_PAYMENTS_MERCHANT_ONBOARDING_FUNNEL:!0,SELLER_EXPERIENCE_SHOP_INSIGHTS_NEW_FUNNEL:!0,SELLER_EXPERIENCE_ONBOARDING_NEW_FUNNEL:!0,SELLER_EXPERIENCE_PAYOUT_SETUP_NEW_FUNNEL:!0,SELLER_EXPERIENCE_SHOP_MANAGEMENT_FUNNEL:!0,CHANNEL_EDIT_FUNNEL:!0,PAYOUT_ONBOARDING_FUNNEL:!0,SERVICES_INSTANT_BOOKING_SETTINGS_FUNNEL:!0,SERVICES_FB_APPOINTMENTS_CTA_CREATION_FUNNEL:!0,SERVICES_FB_APPOINTMENTS_CTA_FULL_SETUP_FUNNEL:!0,MATCHED_MARKET_LIFT_INTERNAL_FUNNEL:!0,FB_NEO_ONBOARDING_FUNNEL:!0,FB_NEO_FRIENDING_FUNNEL:!0,SEARCH_FUNNEL:!0,SHADOW_SEARCH_FUNNEL:!0,SHADOW_EARLY_END_SEARCH_FUNNEL:!0,TEXT_DELIGHTS_OPT_OUT_NUX_FUNNEL:!0,TEXT_DELIGHTS_COMPOSER_FUNNEL:!0,PRIVATE_COMMENT_COMPOSER_FUNNEL:!0,CHECKOUT_EXPERIENCES_FUNNEL:!0,CHECKOUT_EXPERIENCES_SELLER_FUNNEL:!0,MESSENGER_SECONDARY_SEARCH_FUNNEL:!0,WWW_SERVICES_INSTANT_BOOKING_CONSUMER_FUNNEL:!0,WWW_PRESENCE_FUNNEL:!0,WWW_SERVICES_BOOK_APPOINTMENT_CONSUMER_FUNNEL:!0,WWW_SPHERICAL_DIRECTOR_FUNNEL:!0,SELLER_EXPERIENCE_MIGRATION_FUNNEL:!0,SELLER_EXPERIENCE_PAYOUT_SETUP_FUNNEL:!0,NATIVE_SUPPORT_FUNNEL:!0,PRIVACY_SHORTCUTS_FUNNEL:!0,PRIVACY_ACCESS_HUB_FUNNEL:!0,WWW_POLITICIAN_OFFICE_SETTING_FUNNEL:!0,WWW_CIVIC_ACTION_POST_INVITE_FUNNEL:!0,WWW_CIVIC_ACTION_POST_CREATION_FUNNEL:!0,NT_NFAS_EXAMPLE_FUNNEL:!0,WWW_ONCALL_VIEW_FUNNEL:!0,WWW_ESCALATION_TOOLS_NOTIFICATIONS_PAGE_FUNNEL:!0,ALL_VOICES_FUNNEL:!0,WWW_MESSENGER_SHARE_FILE_PREVIEW_FUNNEL:!0,POST_TRANSACTION_FUNNEL:!0,INSTANT_EXPERIENCES_MINDBODY_FUNNEL:!0,WWW_CTW_WHATSAPP_VERIFICATION_FLOW_FUNNEL:!0,PIE_MANAGER_HIRING_HUB_FUNNEL:!0,PIE_RECRUITING_MANAGER_HIRING_OUTREACH_FUNNEL:!0,PIE_RECRUITING_MANAGER_HIRING_REVIEW_FUNNEL:!0,IG_WEB_STORY_CREATION_FUNNEL:!0,IG_WEB_IGTV_CREATION_FUNNEL:!0,IG_WEB_ONE_TAP_REGISTRATION_FUNNEL:!0,IG_WEB_SHARE_FUNNEL:!0,IG_WEB_NUX_FUNNEL:!0,IG_WEB_OBA_FUNNEL:!0,WWW_FB_CHAT_NEW_SETTINGS_MENU_FUNNEL:!0,FLEXIBLE_STARS_WWW_FUNNEL:!0,PAYMENT_APP_FUNNEL:!0,WWW_MESSENGER_VIDEO_CHAT_LINKS_FUNNEL:!0,KAIOS_REG_CONTACT_IMPORTER_FUNNEL:!0,ONEVC_CALL_ROUTING_FUNNEL:!0,AR_HUB_UPLOAD_FUNNEL:!0,FHT_FUNNEL:!0,WWW_PCR_FUNNEL:!0,MARKETPLACE_GIFT_CARD_FUNNEL:!0,WORK_CHAT_SEARCH_FUNNEL:!0,DISCOVER_MIGRATION_FUNNEL:!0,ZERO_PLACEHOLDER_FUNNEL:!0,FOS_MON_PURCHASE_FLOW_FUNNEL:!0});f["default"]=a}),66);
__d("Funnel",["BinarySearch","FunnelAction","FunnelRegistry","sprintf","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h="name",i="instance_id",j="start_time",k="tags",l="actions",m="sampling_rate",n="timeout_sec",o="beacon_id",p="beacon_session_id",q="funnel_level_beacon_id",r="funnel_level_beacon_session_id",s="is_web";a={EXPLICIT:"explicit",TIMEOUT:"timeout",SESSION_END:"session_end",RESTART:"restart",ACTIONS_FULL:"actions_full"};b={ACTION_END:"funnel_end",ACTION_WINDOW_BLUR:"window_blur",ACTION_WINDOW_FOCUS:"window_focus"};var t=600;e=function(){function a(a,b,d,e,f){if(c("FunnelRegistry")[a]!==!0)throw c("unrecoverableViolation")("Funnel name not registered.","comet_infra");this.$1=a;this.$2=b;this.$3=[];this.$4={};this.$5=d;this.$6=f;this.timeout_sec=t;this.shouldTrackFocus=!1;this.$7=e;this.$9=-1;this.$10=-1;this.$11=-1;this.$12=-1;this.$8=null;this.devModeLogger("Started funnel")}var b=a.prototype;b.addTag=function(a){if(typeof a!=="string")throw c("unrecoverableViolation")("Funnel tag should be a String.","comet_infra");this.$4[a]=!0;this.devModeLogger("Added funnel tag %s",a);return this};b.appendAction=function(a,b,e,f){var g=this;f===void 0&&(f=Date.now());f=new(c("FunnelAction"))(a,f-this.$6,b,e);e=d("BinarySearch").leastStrictUpperBound(function(a){return g.$3[a].getData()},f.getData(),0,this.$3.length,function(a,b){if(a.name==="funnel_end")return 1;return b.name==="funnel_end"?-1:a.relative_time-b.relative_time});this.$3.splice(e,0,f);b?this.devModeLogger("Appended action %s with tag %s",a,b):this.devModeLogger("Appended action %s",a);this.$8=a;return this};b.appendActionIfNew=function(a,b,c){a!==this.$8&&this.appendAction(a,b,c);return this};b.getLogData=function(){var a={};a[h]=this.$1;this.$2!==void 0?a[i]=this.$2:a[i]=Math.floor(Math.random()*65536);a[j]=this.$6;a[m]=this.$5;a[n]=this.timeout_sec;a[k]=[];for(var b in this.$4)this.$4[b]===!0&&a[k].push(b);if(this.$3.length>0){a[l]=[];for(b=0;b<this.$3.length;b++)a[l].push(this.$3[b].getData())}this.$10!==-1&&this.$9!==-1&&(a[p]=this.$10,a[o]=this.$9);this.$12!==-1&&this.$11!==-1&&(a[r]=this.$12,a[q]=this.$11);a[s]=1;return a};b.devModeLogger=function(){};b.getTags=function(){return this.$4};b.getFunnelName=function(){return this.$1};b.addReliabilityStats=function(a,b){if(typeof a!=="number")throw c("unrecoverableViolation")("SessionID of current funnel lib reliability stats should be a number.","comet_infra");if(typeof b!=="number")throw c("unrecoverableViolation")("Counter of current funnel lib reliability stats should be a number.","comet_infra");this.$10=a;this.$9=b;this.devModeLogger("Added funnel sessionID %d and counter %d.",a,b);return this};b.addReliabilityStatsForCurFunnel=function(a,b){if(typeof a!=="number")throw c("unrecoverableViolation")("SessionID of current funnel lib reliability stats should be a number.","comet_infra");if(typeof b!=="number")throw c("unrecoverableViolation")("Counter of current funnel lib reliability stats should be a number.","comet_infra");this.$12=a;this.$11=b;this.devModeLogger("Added funnel sessionID %d and counter %d.",a,b);return this};return a}();g.EndType=a;g.ActionType=b;g.Funnel=e}),98);
__d("FunnelLoggerSampler",["FunnelLoggerConfig"],(function(a,b,c,d,e,f){"use strict";function a(a){a=g(a);return a===0?!1:Math.random()*a<1}function g(a){a=b("FunnelLoggerConfig").freq[a];a===void 0&&(a=b("FunnelLoggerConfig").freq["default"]);return a}e.exports={shouldLog:a,getSamplingRate:g}}),null);
__d("FunnelReliabilityWhitelist",[],(function(a,b,c,d,e,f){a=["SEARCH_FUNNEL"];f["default"]=a}),66);
__d("FunnelReliabilityStatsCollector",["FunnelReliabilityWhitelist","MarauderLogger","WebStorage","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h=!1,i,j="fas_reliability_lib_stats_overall",k="fas_reliability_funnel_stats_overall",l=1800,m="funnel_analytics_data_loss",n="fas_reliability_lib_stats_wl",o="fas_reliability_funnel_stats_wl",p=0,q={};function a(){return c("gkx")("676890")?!0:!1}function r(){h||(h=!0,i=c("WebStorage").getLocalStorage());return i}function s(){var a=r();if(!a)return null;a=a.getItem(k);if(a)return JSON.parse(a);else{a=Math.floor(Date.now()/1e3);return{startCount:0,endCount:0,cancelCount:0,prevCount:0,lastFlushTimestamp:a}}}function t(a){var b=r();if(!b)return null;b=b.getItem(o);if(b)return JSON.parse(b);else{b={};b[a]={startCount:0,endCount:0,cancelCount:0,prevCount:0};return b}}function u(){var a=r();if(!a)return null;a=a.getItem(o);return a?JSON.parse(a):null}function b(a){var b=s();if(!b)return;p+=1;b.startCount?b.startCount=parseInt(b.startCount,10)+1:b.startCount=1;c("WebStorage").setItemGuarded(localStorage,k,JSON.stringify(b));v(a)}function v(a){var b=t(a);if(!b||!c("FunnelReliabilityWhitelist").includes(a))return;var d=q[a]?q[a]+1:1;q[a]=d;d=b[a];d?d.startCount?d.startCount=parseInt(d.startCount,10)+1:d.startCount=1:(d={},d.startCount=1,d.prevCount=0,d.cancelCount=0,d.endCount=0);b[a]=d;c("WebStorage").setItemGuarded(localStorage,o,JSON.stringify(b))}function e(a){var b=s();if(!b)return;p-=1;b.cancelCount?b.cancelCount=parseInt(b.cancelCount,10)+1:b.cancelCount=1;c("WebStorage").setItemGuarded(localStorage,k,JSON.stringify(b));w(a)}function w(a){var b=t(a);if(!b||!c("FunnelReliabilityWhitelist").includes(a))return;var d=q[a]?q[a]-1:0;q[a]=d;d=b[a];d?d.cancelCount?d.cancelCount=parseInt(d.cancelCount,10)+1:d.cancelCount=1:(d={},d.startCount=0,d.prevCount=0,d.cancelCount=1,d.endCount=0);b[a]=d;c("WebStorage").setItemGuarded(localStorage,o,JSON.stringify(b))}function f(a){var b=s();if(!b)return;p-=1;b.endCount?b.endCount=parseInt(b.endCount,10)+1:b.endCount=1;c("WebStorage").setItemGuarded(localStorage,k,JSON.stringify(b));x(a)}function x(a){var b=t(a);if(!b||!c("FunnelReliabilityWhitelist").includes(a))return;var d=q[a]?q[a]-1:0;q[a]=d;d=b[a];d?d.endCount?d.endCount=parseInt(d.endCount,10)+1:d.endCount=1:(d={},d.startCount=0,d.prevCount=0,d.cancelCount=0,d.endCount=1);b[a]=d;c("WebStorage").setItemGuarded(localStorage,o,JSON.stringify(b))}function y(){var a=s();if(!a)return!1;if(a.lastFlushTimestamp){var b=Math.floor(Date.now()/1e3);return b-parseInt(a.lastFlushTimestamp,10)>=l}return!1}function z(a,b){a=r();if(!a)return;var d=Math.floor(Date.now()/1e3);b={startCount:0,endCount:0,cancelCount:0,prevCount:b,lastFlushTimestamp:d};c("WebStorage").setItemGuarded(a,k,JSON.stringify(b))}function A(a,b){var d=r();if(!d||!a||Object.keys(a).length==0)return;var e={};for(a in a){var f=b[a];f={startCount:0,endCount:0,cancelCount:0,prevCount:f?f:0};e[a]=f}c("WebStorage").setItemGuarded(d,o,JSON.stringify(e))}function B(a,b,c,e){var f=a.prevCount,g=a.startCount,h=a.endCount;a=a.cancelCount;var i=f+g-h-a-b;g={start:g,end:h,cancel:a,prev:f,ongoing:b,loss:i};h={overall:g};if(c){a={};for(f in c){b=c[f];i=b.prevCount;g=b.startCount;var j=b.endCount;b=b.cancelCount;var k=e[f]?e[f]:0,l=i+g-j-b-k;g={start:g,end:j,cancel:b,prev:i,ongoing:k,loss:l};a[f]=g}h.funnel_level_data_loss=a}d("MarauderLogger").log(m,null,h)}function C(){if(!y())return;var a=s();if(!a)return;z(a,p);var b=u();b&&A(b,q);B(a,p,b,q)}function D(){var a=r();if(!a)return null;var b=a.getItem(j);b=b?JSON.parse(b):{};var d=b.counter,e=b.session;d?(d=parseInt(d,10)+1,e=parseInt(b.session,10)):(d=1,e=Math.floor(Math.random()*65536));c("WebStorage").setItemGuarded(a,j,JSON.stringify({counter:d,session:e}));return[e,d]}function E(a){if(!c("FunnelReliabilityWhitelist").includes(a))return null;var b=r();if(!b)return null;var d=b.getItem(n),e=void 0,f={};d&&(f=JSON.parse(d),e=f[a]);var g=e?e.counter:void 0;e=e?e.session:void 0;g?(g=parseInt(g,10)+1,e=parseInt(e,10)):(g=1,e=Math.floor(Math.random()*65536));var h={};d?(f[a]={counter:g,session:e},h=f):h[a]={counter:g,session:e};c("WebStorage").setItemGuarded(b,n,JSON.stringify(h));return[e,g]}g.passFunnelLevelStatsRolloutGK=a;g.onFunnelStart=b;g.onFunnelCancel=e;g.onFunnelEnd=f;g.maybeFlushFunnelLevelStats=C;g.increaseAndGetLibLevelStats=D;g.maybeIncreaseAndGetLibLevelStatsForCurFunnel=E}),98);
__d("FunnelLogger",["Banzai","FBLogger","Funnel","FunnelLoggerSampler","FunnelRegistry","FunnelReliabilityStatsCollector","MarauderLogger","clearTimeout","gkx","setTimeout","unrecoverableViolation"],(function(a,b,c,d,e,f){"use strict";var g={},h=!1,i=!0;function a(a,b){B(a,b)}function c(a,b,c){B(a,c,b)}function d(a,b){a=D(a,b);return!E(a)?null:g[a]}function f(a,b){}function j(a,b,c){c===void 0?F(a,void 0,b):c&&F(a,b,c)}function k(a,c){c=D(a,c);E(c)&&(g[c].devModeLogger("Cancelled funnel"),H(c),g[c]=void 0,b("FunnelReliabilityStatsCollector").passFunnelLevelStatsRolloutGK()&&(b("FunnelReliabilityStatsCollector").onFunnelCancel(a),b("FunnelReliabilityStatsCollector").maybeFlushFunnelLevelStats()))}function l(a,b){C(a,b)}function m(a,b,c){C(a,c,b)}function n(a,b,c){c===void 0?I(a,void 0,String(b)):I(a,Number(b),c)}function o(a,b,c){c===void 0?J(a,void 0,Boolean(b)):J(a,Number(b),c)}function p(a,b,c){c===void 0?K(a,void 0,String(b),void 0):K(a,Number(b),c,void 0)}function q(a,b,c){c===void 0?L(a,void 0,String(b),void 0):L(a,Number(b),c,void 0)}function r(a,b,c,d){d===void 0?K(a,void 0,String(c),void 0,void 0,b):K(a,Number(c),d,void 0,void 0,b)}function s(a,b,c,d){d===void 0?K(a,void 0,String(b),c):K(a,Number(b),c,d)}function t(a,b,c,d,e){e===void 0?K(a,void 0,String(c),d,void 0,b):K(a,Number(c),d,e,void 0,b)}function u(a,b,c,d){d===void 0?L(a,void 0,String(b),c):L(a,Number(b),c,d)}function v(a,b,c,d){d===void 0?K(a,void 0,String(b),void 0,c):K(a,Number(b),String(c),void 0,d)}function w(a,b,c,d,e){e===void 0?K(a,void 0,String(c),void 0,d,b):K(a,Number(c),String(d),void 0,e,b)}function x(a,b,c,d){d===void 0?L(a,void 0,String(b),void 0,c):L(a,Number(b),String(c),void 0,d)}function y(a,b,c,d,e){e===void 0?K(a,void 0,String(b),c,d):K(a,Number(b),String(c),String(d),e)}function z(a,b,c,d,e,f){f===void 0?K(a,void 0,String(c),d,e,b):K(a,Number(c),String(d),String(e),f,b)}function A(a,b,c,d,e){e===void 0?L(a,void 0,String(b),c,d):L(a,Number(b),String(c),String(d),e)}function B(a,c,d){var e=D(a,c);R();M(e);b("FunnelLoggerSampler").shouldLog(a)&&(g[e]=new(b("Funnel").Funnel)(a,c,b("FunnelLoggerSampler").getSamplingRate(a),!1,d!=null?d:Date.now()),G(e),b("FunnelReliabilityStatsCollector").passFunnelLevelStatsRolloutGK()&&(b("FunnelReliabilityStatsCollector").onFunnelStart(a),b("FunnelReliabilityStatsCollector").maybeFlushFunnelLevelStats()))}function C(a,c,d){a=D(a,c);E(a)&&(g[a].appendAction(b("Funnel").ActionType.ACTION_END,b("Funnel").EndType.EXPLICIT,void 0,d),N(a))}function D(a,c){if(b("FunnelRegistry")[a]!==!0){b("FBLogger")("funnel_validation").blameToPreviousFile().mustfix("Funnel name `%s` not registered",a);throw b("unrecoverableViolation")("Funnel name `"+a+"` not registered.","comet_infra")}if(c==null)return a;else return a+c.toString()}function E(a){return g[a]!==void 0}function F(a,b,c){a=D(a,b);E(a)&&(g[a].timeout_sec=c,g[a].devModeLogger("Timeout set to %s sec",c),G(a))}function G(a){H(a),g[a].timeout_handle=b("setTimeout")(function(){g[a].appendAction(b("Funnel").ActionType.ACTION_END,b("Funnel").EndType.TIMEOUT),N(a)},1e3*g[a].timeout_sec)}function H(a){g[a].timeout_handle&&b("clearTimeout")(g[a].timeout_handle)}function I(a,b,c){a=D(a,b);E(a)&&(g[a].addTag(c),G(a))}function J(a,b,c){a=D(a,b);E(a)&&(g[a].shouldTrackFocus=c,g[a].devModeLogger("Focus tracking %s",c?"on":"off"))}function K(a,b,c,d,e,f){a=D(a,b);E(a)&&(g[a].appendAction(c,d,e,f),G(a))}function L(a,b,c,d,e){a=D(a,b);E(a)&&g[a].appendActionIfNew(c,d,e)}function M(a){E(a)&&(g[a].appendAction(b("Funnel").ActionType.ACTION_END,b("Funnel").EndType.RESTART),N(a))}function N(a){if(E(a)){if(b("gkx")("676888")){var c=b("FunnelReliabilityStatsCollector").increaseAndGetLibLevelStats();if(c){var d=c[0];c=c[1];g[a].addReliabilityStats(d,c)}}d=g[a].getFunnelName();c=g[a].getLogData();b("MarauderLogger").log("funnel_analytics",null,c);g[a].devModeLogger("Logged: %s",JSON.stringify(c));H(a);g[a]=void 0;b("FunnelReliabilityStatsCollector").passFunnelLevelStatsRolloutGK()&&(b("FunnelReliabilityStatsCollector").onFunnelEnd(d),b("FunnelReliabilityStatsCollector").maybeFlushFunnelLevelStats())}}function O(){for(var a in g)Object.prototype.hasOwnProperty.call(g,a)&&E(a)&&(g[a].appendAction(b("Funnel").ActionType.ACTION_END,b("Funnel").EndType.SESSION_END),N(a))}function P(){if(i){i=!1;for(var a in g)Object.prototype.hasOwnProperty.call(g,a)&&E(a)&&g[a].shouldTrackFocus&&(g[a].appendAction(b("Funnel").ActionType.ACTION_WINDOW_BLUR),H(a))}}function Q(){if(!i){i=!0;for(var a in g)Object.prototype.hasOwnProperty.call(g,a)&&E(a)&&g[a].shouldTrackFocus&&(g[a].appendAction(b("Funnel").ActionType.ACTION_WINDOW_FOCUS),H(a))}}function R(){h||(h=!0,window.addEventListener&&(b("Banzai").subscribe(b("Banzai").SHUTDOWN,O),window.addEventListener("blur",P),window.addEventListener("focus",Q)))}e.exports={addFunnelTag:n,appendAction:p,appendActionAtTime:r,appendActionAtTimeWithPayload:w,appendActionAtTimeWithTag:t,appendActionAtTimeWithTagAndPayload:z,appendActionIfNew:q,appendActionWithPayload:v,appendActionWithPayloadIfNew:x,appendActionWithTag:s,appendActionWithTagAndPayload:y,appendActionWithTagAndPayloadIfNew:A,appendActionWithTagIfNew:u,cancelFunnel:k,endFunnel:l,endFunnelAtTime:m,getFunnelInstance:d,setFunnelTimeout:j,setFunnelTrackFocus:o,startFunnel:a,startFunnel_DEV_MODE:f,startFunnelAtTime:c}}),null);